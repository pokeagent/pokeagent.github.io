<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Leaderboard - PokéAgent Challenge</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- Header -->
  <header>
    <div class="container header-container">
      <a href="index.html" class="logo">PokéAgent Challenge</a>
      <div class="mobile-toggle">
        <i class="fas fa-bars"></i>
      </div>
      <ul class="nav-menu">
        <li><a href="index.html">Home</a></li>
        <li><a href="track1.html">Track 1</a></li>
        <li><a href="track2.html">Track 2</a></li>
        <li><a href="leaderboard.html">Leaderboard</a></li>
        <li><a href="rules.html">Rules</a></li>
        <li><a href="hackathon.html">Hackathon</a></li>
        <li><a href="index.html#sponsors">Sponsors</a></li>
        <li><a href="faq.html">FAQ</a></li>
      </ul>
    </div>
  </header>

  <!-- Leaderboard Section -->
  <section id="leaderboard" style="background-color: #f5f5f5; margin-top: 70px;">
    <div class="container">
      <h2 class="text-center mb-2">Leaderboard</h2>
      <p class="text-center mb-2">Current rankings for both competition tracks. Leaderboards are updated regularly throughout the competition.</p>

      <!-- Tab Navigation -->
      <!-- <div class="tab-container mb-2">
        <button class="tab-button active" onclick="switchTab('speedrunning')">Track 2: RPG Speedrunning</button>
        <button class="tab-button" onclick="switchTab('battling')">Track 1: Competitive Battling</button>
      </div> -->

      <!-- Battling Tab -->
      <div id="battling-tab" class="tab-content active">
        <h3>Track 1: Competitive Battling</h3>
        
        <!-- Controls -->
        <div class="format-selector" style="text-align: center; margin-bottom: 1.5rem;">
          <label for="sort-select">Sort by:</label>
          <select id="sort-select" onchange="sortLeaderboard()">
            <option value="elo" selected>ELO</option>
            <option value="gxe">GXE</option>
            <option value="glicko">Glicko-1</option>
            <option value="wins">Wins</option>
            <option value="losses">Losses</option>
          </select>
          
          <label for="hide-baselines" style="margin-left: 2rem;">
            <input type="checkbox" id="hide-baselines" onchange="toggleBaselines()" checked style="margin-right: 0.5rem;">
            Hide organizer baselines
          </label>
          
          <label for="show-llm-only" style="margin-left: 2rem;">
            <input type="checkbox" id="show-llm-only" onchange="toggleLLMOnly()" disabled style="margin-right: 0.5rem;">
            Show LLM-based methods only (Gen 9 OU)
          </label>
        </div>
        
        <!-- Baseline Explanation -->
        <div id="baseline-explanation" style="display: none; text-align: center; margin: 1.5rem 0; padding: 1rem; background: rgba(255, 255, 255, 0.9); border-radius: 8px; border-left: 4px solid #ff9800;">
          <p style="margin: 0; font-size: 1.1rem; color: #555; line-height: 1.4;">
            Entries with <span style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 1px 4px; border-radius: 4px; font-size: 0.7rem; font-weight: 600;">ORG</span> badges are <strong>organizer-hosted baseline opponents</strong>. 
            They are not eligible for prizes but are listed here as a point of reference; 
            many of the stronger baselines have published ratings against human players.
          </p>
        </div>
        
        <!-- Side-by-side Leaderboards -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2.5rem; margin-bottom: 2rem;">
          
          <!-- Gen1OU Leaderboard -->
          <div style="
            background: white; 
            border: 3px solid #2d3748; 
            border-radius: 12px; 
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
            overflow: hidden;
          ">
            <div style="
              background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
              color: white; 
              padding: 1.5rem; 
              text-align: center;
              border-bottom: 2px solid #2d3748;
            ">
              <h3 style="margin: 0; font-size: 1.5rem; font-weight: 600; text-shadow: 0 1px 2px rgba(0,0,0,0.2);">
                Gen 1 OU
              </h3>
            </div>
            <div style="
              max-height: 320px; 
              overflow-y: auto;
              scrollbar-width: thin;
              scrollbar-color: #cbd5e0 #f7fafc;
            ">
              <table style="width: 100%; border-collapse: collapse;">
                <thead style="position: sticky; top: 0; background-color: #f8fafc; z-index: 1; border-bottom: 2px solid #e2e8f0;">
                  <tr>
                    <th style="padding: 12px 10px; font-size: 0.9rem; font-weight: 600; color: #4a5568; text-align: left;">Rank</th>
                    <th style="padding: 12px 10px; font-size: 0.9rem; font-weight: 600; color: #4a5568; text-align: left;">Username</th>
                    <th style="padding: 12px 10px; font-size: 0.9rem; font-weight: 600; color: #4a5568; text-align: center;">ELO</th>
                    <th style="padding: 12px 10px; font-size: 0.9rem; font-weight: 600; color: #4a5568; text-align: center;">GXE</th>
                    <th style="padding: 12px 10px; font-size: 0.9rem; font-weight: 600; color: #4a5568; text-align: center;">W/L</th>
                  </tr>
                </thead>
                <tbody id="gen1ou-leaderboard">
                  <tr style="border-bottom: 1px solid #e2e8f0;">
                    <td style="padding: 10px; color: #718096;">1</td>
                    <td style="padding: 10px; color: #718096;">Loading...</td>
                    <td style="padding: 10px; text-align: center; color: #718096;">-</td>
                    <td style="padding: 10px; text-align: center; color: #718096;">-</td>
                    <td style="padding: 10px; text-align: center; color: #718096;">-</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          
          <!-- Gen9OU Leaderboard -->
          <div style="
            background: white; 
            border: 3px solid #2d3748; 
            border-radius: 12px; 
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
            overflow: hidden;
          ">
            <div style="
              background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); 
              color: white; 
              padding: 1.5rem; 
              text-align: center;
              border-bottom: 2px solid #2d3748;
            ">
              <h3 style="margin: 0; font-size: 1.5rem; font-weight: 600; text-shadow: 0 1px 2px rgba(0,0,0,0.2);">
                Gen 9 OU
              </h3>
            </div>
            <div style="
              max-height: 320px; 
              overflow-y: auto;
              scrollbar-width: thin;
              scrollbar-color: #cbd5e0 #f7fafc;
            ">
              <table style="width: 100%; border-collapse: collapse;">
                <thead style="position: sticky; top: 0; background-color: #f8fafc; z-index: 1; border-bottom: 2px solid #e2e8f0;">
                  <tr>
                    <th style="padding: 12px 10px; font-size: 0.9rem; font-weight: 600; color: #4a5568; text-align: left;">Rank</th>
                    <th style="padding: 12px 10px; font-size: 0.9rem; font-weight: 600; color: #4a5568; text-align: left;">Username</th>
                    <th style="padding: 12px 10px; font-size: 0.9rem; font-weight: 600; color: #4a5568; text-align: center;">ELO</th>
                    <th style="padding: 12px 10px; font-size: 0.9rem; font-weight: 600; color: #4a5568; text-align: center;">GXE</th>
                    <th style="padding: 12px 10px; font-size: 0.9rem; font-weight: 600; color: #4a5568; text-align: center;">W/L</th>
                  </tr>
                </thead>
                <tbody id="gen9ou-leaderboard">
                  <tr style="border-bottom: 1px solid #e2e8f0;">
                    <td style="padding: 10px; color: #718096;">1</td>
                    <td style="padding: 10px; color: #718096;">Loading...</td>
                    <td style="padding: 10px; text-align: center; color: #718096;">-</td>
                    <td style="padding: 10px; text-align: center; color: #718096;">-</td>
                    <td style="padding: 10px; text-align: center; color: #718096;">-</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          
        </div>
        
        <!-- Mobile responsive: stack on small screens -->
        <style>
          @media (max-width: 768px) {
            div[style*="grid-template-columns: 1fr 1fr"] {
              grid-template-columns: 1fr !important;
            }
          }
          
          /* Custom scrollbar styling for webkit browsers */
          div[style*="overflow-y: auto"]::-webkit-scrollbar {
            width: 8px;
          }
          
          div[style*="overflow-y: auto"]::-webkit-scrollbar-track {
            background: #f7fafc;
            border-radius: 4px;
          }
          
          div[style*="overflow-y: auto"]::-webkit-scrollbar-thumb {
            background: #cbd5e0;
            border-radius: 4px;
          }
          
          div[style*="overflow-y: auto"]::-webkit-scrollbar-thumb:hover {
            background: #a0aec0;
          }
        </style>
        
        <!-- Last Updated and Live Ladder Link -->
        <div style="text-align: center; margin-top: 1.5rem;">
          <div style="color: #666; font-size: 0.9rem; margin-bottom: 1rem;">
            <span id="last-updated">Last updated: Loading...</span>
            <br>
            <em>Leaderboard is updated daily. Live leaderboard is available on the PokéAgent ladder.</em>
            <br>
            <small style="color: #888; margin-top: 0.5rem; display: block;">
              Only players with Glicko-1 Deviation ≤ 80 are shown.
            </small>
          </div>
          
          <!-- Live Ladder Button -->
          <div style="display: flex; align-items: center; gap: 1.5rem; flex-wrap: wrap; justify-content: center; text-align: center; padding: 2rem; background: rgba(255, 255, 255, 0.8); border-radius: 8px; border: 1px solid #e0e0e0; margin: 1rem 0;">
            <i class="fas fa-trophy" style="font-size: 1.5rem; color: #ff9800;"></i>
            <p style="margin: 0; font-size: 1rem; color: #333;">
              For real-time updates and additional battle formats, visit the 
              <strong>live PokéAgent Challenge Ladder</strong>
            </p>
            <a href="http://pokeagentshowdown.com.insecure.psim.us/ladder" target="_blank" class="btn btn-primary">
              <i class="fas fa-external-link-alt"></i> View Live Ladder
            </a>
          </div>
        </div>
      </div>

      <!-- Spacer between Track 1 and Track 2 -->
      <div style="height: 3rem; margin: 2rem 0;"></div>

      <!-- Speedrunning Tab -->
      <div id="speedrunning-tab" class="tab-content active">
        <h3>Track 2: RPG Speedrunning</h3>
        
        <!-- View Mode Selector -->
        <div class="format-selector" style="text-align: center; margin-bottom: 1.5rem;">
          <label for="view-mode-select">View mode:</label>
          <select id="view-mode-select" onchange="changeViewMode()" style="margin-right: 2rem;">
            <option value="overall">Overall Progress</option>
            <option value="milestones">Milestone Splits</option>
          </select>
          
          <label for="milestone-select" id="milestone-filter-label" style="display: none;">Filter by milestone:</label>
          <select id="milestone-select" onchange="filterByMilestone()" style="display: none;">
            <option value="all">All (Furthest Milestone)</option>
            <option value="Phase_1_Game_Initialization">Milestone 1: Game Start</option>
            <option value="Phase_2_Tutorial_Starting_Town">Milestone 2: Littleroot Town</option>
            <option value="Phase_3_Professor_Birch_Starter">Milestone 3: Starter Pokemon</option>
            <option value="Phase_4_Rival">Milestone 4: Rival Battle</option>
            <option value="Phase_5_Route_102_Petalburg">Milestone 5: Petalburg City</option>
            <option value="Phase_6_Road_to_Rustboro_City">Milestone 6: Route to Rustboro</option>
            <option value="Phase_7_First_Gym_Challenge">Milestone 7: First Gym</option>
          </select>
        </div>
        
        <p id="view-description" style="font-size: 0.85rem; color: #666; margin-bottom: 1rem; text-align: center;">
          <strong>Overall Progress View:</strong> Shows completion percentage and cumulative runtime to furthest milestone. Teams with multiple submissions show their best combined splits.
        </p>
        
      <div style="
        background: white; 
        border: 3px solid #2d3748; 
        border-radius: 12px; 
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        overflow: hidden;
      ">
        <div style="
          background: linear-gradient(135deg, #48bb78 0%, #2f855a 100%); 
          color: white; 
          padding: 1.5rem; 
          text-align: center;
          border-bottom: 2px solid #2d3748;
        ">
          <h3 style="margin: 0; font-size: 1.5rem; font-weight: 600; text-shadow: 0 1px 2px rgba(0,0,0,0.2);">
            Emerald
          </h3>
        </div>
        <div style="
          max-height: 400px; 
          overflow-y: auto;
          scrollbar-width: thin;
          scrollbar-color: #cbd5e0 #f7fafc;
        ">
          <table style="width: 100%; border-collapse: collapse;">
            <thead id="speedrunning-header" style="position: sticky; top: 0; background-color: #f8fafc; z-index: 1; border-bottom: 2px solid #e2e8f0;">
              <tr>
                <th style="padding: 12px 15px; font-size: 0.9rem; font-weight: 600; color: #4a5568; text-align: left;">Rank</th>
                <th style="padding: 12px 15px; font-size: 0.9rem; font-weight: 600; color: #4a5568; text-align: left;">Team</th>
                <th style="padding: 12px 15px; font-size: 0.9rem; font-weight: 600; color: #4a5568; text-align: center;">Progress</th>
                <th style="padding: 12px 15px; font-size: 0.9rem; font-weight: 600; color: #4a5568; text-align: center;">Runtime</th>
                <th style="padding: 12px 15px; font-size: 0.9rem; font-weight: 600; color: #4a5568; text-align: center;">Details</th>
              </tr>
            </thead>
            <tbody id="speedrunning-leaderboard">
              <tr style="border-bottom: 1px solid #e2e8f0;">
                <td style="padding: 15px; color: #718096;" colspan="5">Loading leaderboard data...</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

      
    </div>
  </section>

  <!-- Footer -->
  <footer>
    <div class="container">
      <div class="footer-container">
        <div class="footer-column">
          <h3>PokéAgent Challenge</h3>
          <p>A NeurIPS 2025 competition advancing AI decision-making through the complex environments of Pokémon battles and gameplay.</p>
          <div class="social-links mt-1">
            <a href="https://x.com/intent/post?text=Excited%20to%20join%20the%20%23PokeAgent%20Challenge%20at%20%23NeurIPS2025!%20%F0%9F%8E%AE%E2%9A%A1%20Advancing%20AI%20decision-making%20through%20Pok%C3%A9mon%20battles%20and%20speedruns.%20Learn%20more%3A%20https%3A%2F%2Fpokeagent.github.io" target="_blank"><i class="fab fa-x-twitter"></i></a>
            <a href="#"><i class="fab fa-github"></i></a>
                                    <a href="https://discord.gg/E2DuX5FWF7"><i class="fab fa-discord"></i></a>
            <a href="https://www.youtube.com/@PokeAgentChallenge" target="_blank"><i class="fab fa-youtube"></i></a>
          </div>
        </div>
        <div class="footer-column">
          <h3>Quick Links</h3>
          <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="track1.html">Track 1</a></li>
            <li><a href="track2.html">Track 2</a></li>
            <li><a href="leaderboard.html">Leaderboard</a></li>
            <li><a href="rules.html">Rules</a></li>
        <li><a href="hackathon.html">Hackathon</a></li>
            <li><a href="faq.html">FAQ</a></li>
          </ul>
        </div>

        <div class="footer-column">
          <h3>Contact</h3>
          <p>For questions or support, please contact:</p>
          <p>Email: pokeagentchallenge@gmail.com</p>
          <p>Join our Discord community for direct assistance and discussions.</p>
        </div>
      </div>
      <div class="copyright">
        <p>&copy; 2025 PokéAgent Challenge. All rights reserved. NeurIPS 2025 Competition Track.</p>
      </div>
    </div>
  </footer>

  <!-- JavaScript -->
  <script>
    const mobileToggle = document.querySelector('.mobile-toggle');
    const navMenu = document.querySelector('.nav-menu');

    mobileToggle.addEventListener('click', () => {
      navMenu.classList.toggle('active');
    });

    const navLinks = document.querySelectorAll('.nav-menu a');
    navLinks.forEach(link => {
      link.addEventListener('click', () => {
        navMenu.classList.remove('active');
      });
    });

    // Global variables for leaderboard data
    let speedrunningData = [];
    let track1Data = {};
    let currentFormat = 'gen1ou';
    let currentSortBy = 'elo';
    let hideBaselines = true;
    let showLLMOnly = false;

    // Tab switching function
    // function switchTab(tabName) {
    //   // Update tab buttons
    //   document.querySelectorAll('.tab-button').forEach(button => {
    //     button.classList.remove('active');
    //   });
    //   document.querySelector(`[onclick="switchTab('${tabName}')"]`).classList.add('active');
      
    //   // Update tab content
    //   document.querySelectorAll('.tab-content').forEach(content => {
    //     content.classList.remove('active');
    //   });
    //   document.getElementById(`${tabName}-tab`).classList.add('active');
    // }

    // Sorting function for Track 1 leaderboard
    function sortLeaderboard() {
      const select = document.getElementById('sort-select');
      currentSortBy = select.value;
      displayTrack1Leaderboards();
    }

    // Toggle baselines visibility
    function toggleBaselines() {
      const checkbox = document.getElementById('hide-baselines');
      const explanationDiv = document.getElementById('baseline-explanation');
      const llmCheckbox = document.getElementById('show-llm-only');
      hideBaselines = checkbox.checked;
      
      console.log('toggleBaselines: hideBaselines =', hideBaselines, ', showLLMOnly =', showLLMOnly);
      
      // If hiding baselines, disable LLM-only filter and disable the checkbox
      if (hideBaselines && showLLMOnly) {
        llmCheckbox.checked = false;
        showLLMOnly = false;
        console.log('Unchecked LLM filter because baselines are hidden');
      }
      
      // Enable/disable LLM checkbox based on baseline visibility
      llmCheckbox.disabled = hideBaselines;
      console.log('LLM checkbox disabled:', llmCheckbox.disabled);
      
      // Hide/show the baseline explanation
      explanationDiv.style.display = hideBaselines ? 'none' : 'block';
      
      displayTrack1Leaderboards();
    }

    // Toggle LLM-only visibility
    function toggleLLMOnly() {
      const checkbox = document.getElementById('show-llm-only');
      const baselineCheckbox = document.getElementById('hide-baselines');
      const explanationDiv = document.getElementById('baseline-explanation');
      showLLMOnly = checkbox.checked;
      
      // If enabling LLM-only, ensure baselines are shown (uncheck hide baselines)
      if (showLLMOnly && hideBaselines) {
        baselineCheckbox.checked = false;
        hideBaselines = false;
        explanationDiv.style.display = 'block';
        console.log('Unchecked hide baselines to show LLM methods');
      }
      
      displayTrack1Leaderboards();
    }

    // Display both Gen1OU and Gen9OU leaderboards
    function displayTrack1Leaderboards() {
      displayFormatLeaderboard('gen1ou', 'gen1ou-leaderboard');
      displayFormatLeaderboard('gen9ou', 'gen9ou-leaderboard');
    }

    // Helper function to get numeric value for sorting
    function getNumericValue(value) {
      if (!value || value === '-') return 0;
      // Remove % sign and convert to number
      const numStr = value.toString().replace('%', '');
      const num = parseFloat(numStr);
      return isNaN(num) ? 0 : num;
    }

    // Display leaderboard for a specific format
    function displayFormatLeaderboard(format, tableBodyId) {
      const tableBody = document.getElementById(tableBodyId);
      
      if (!track1Data.formats || !track1Data.formats[format]) {
        tableBody.innerHTML = `<tr style="border-bottom: 1px solid #e2e8f0;">
          <td style="padding: 10px; color: #718096;">-</td>
          <td style="padding: 10px; color: #718096;">No data available</td>
          <td style="padding: 10px; text-align: center; color: #718096;">-</td>
          <td style="padding: 10px; text-align: center; color: #718096;">-</td>
          <td style="padding: 10px; text-align: center; color: #718096;">-</td>
        </tr>`;
        return;
      }

      let players = [...track1Data.formats[format]]; // Create a copy for sorting
      
      // Filter out baselines if hideBaselines is true
      if (hideBaselines) {
        players = players.filter(player => {
          const username = player.username.original || player.username.display;
          // Filter out organizer baselines: starter kits and PAC-LLM users
          return !player.username.is_starter_kit && !username.startsWith('PAC-LLM-');
        });
      }
      
      // Filter for LLM methods only if showLLMOnly is true (only for Gen 9 OU when baselines are shown)
      if (showLLMOnly && format === 'gen9ou' && !hideBaselines) {
        console.log('Filtering for LLM methods. All usernames in gen9ou:', 
          players.map(p => p.username.original || p.username.display));
        
        players = players.filter(player => {
          const username = player.username.original || player.username.display;
          // Normalize Unicode to handle different representations of accented characters
          const normalizedUsername = username.normalize('NFD');
          
          // Non-LLM PAC-PC entries to exclude
          const nonLLMPacPC = ['PAC-PC-ABYSSAL', 'PAC-PC-DC', 'PAC-PC-FAST', 'PAC-PC-MAX-POWER'];
          
          const isLLM = (normalizedUsername.startsWith('PAC-PokeChamp-') || 
                         normalizedUsername.startsWith('PAC-PokéChamp-'.normalize('NFD')) || 
                         normalizedUsername.startsWith('PAC-LLM-') ||
                         (normalizedUsername.startsWith('PAC-PC-') && !nonLLMPacPC.includes(normalizedUsername)));
          
          console.log(`Username: "${username}" - Normalized: "${normalizedUsername}" - isLLM: ${isLLM}`);
          return isLLM;
        });
        
        console.log('Filtered LLM players:', players.length);
      }
      
      // Sort players based on current sort criteria
      players.sort((a, b) => {
        let aVal, bVal;
        
        switch(currentSortBy) {
          case 'gxe':
            aVal = getNumericValue(a.gxe);
            bVal = getNumericValue(b.gxe);
            return bVal - aVal; // Descending order
          case 'glicko':
            aVal = getNumericValue(a.glicko);
            bVal = getNumericValue(b.glicko);
            return bVal - aVal; // Descending order
          case 'wins':
            aVal = getNumericValue(a.wins);
            bVal = getNumericValue(b.wins);
            return bVal - aVal; // Descending order
          case 'losses':
            aVal = getNumericValue(a.losses);
            bVal = getNumericValue(b.losses);
            return aVal - bVal; // Ascending order (fewer losses is better)
          case 'elo':
          default:
            aVal = getNumericValue(a.elo);
            bVal = getNumericValue(b.elo);
            return bVal - aVal; // Descending order
        }
      });

      tableBody.innerHTML = '';

      players.forEach((player, index) => {
        const username = player.username;
        const originalUsername = username.original || username.display;
        const isBaseline = username.is_starter_kit || originalUsername.startsWith('PAC-LLM-');
        
        // Create baseline badge if needed
        const baselineBadge = isBaseline ? 
          '<span style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 1px 4px; border-radius: 3px; font-size: 0.6rem; font-weight: 600; margin-left: 4px; vertical-align: middle; display: inline-block;">ORG</span>' : 
          '';
        
        const usernameStyle = 'font-weight: 500;';
        
        // Use position based on current sort
        const displayRank = index + 1;
        
        // Format GXE to 1 decimal place
        const formattedGxe = player.gxe && player.gxe !== '-' ? 
          parseFloat(player.gxe.toString().replace('%', '')).toFixed(1) + '%' : 
          '-';
        
        // Combine wins/losses for compact display
        const wlRatio = `${player.wins || '0'}/${player.losses || '0'}`;
        
        const row = `<tr style="border-bottom: 1px solid #e2e8f0; transition: background-color 0.2s;" onmouseover="this.style.backgroundColor='#f8fafc'" onmouseout="this.style.backgroundColor='white'">
          <td style="padding: 10px; font-weight: 600; color: #2d3748;">${displayRank}</td>
          <td style="padding: 10px; ${usernameStyle}">${username.display}${baselineBadge}</td>
          <td style="padding: 10px; text-align: center; font-weight: 500; color: #2d3748;">${player.elo || '-'}</td>
          <td style="padding: 10px; text-align: center; font-weight: 500; color: #2d3748;">${formattedGxe}</td>
          <td style="padding: 10px; text-align: center; font-weight: 500; color: #2d3748;">${wlRatio}</td>
        </tr>`;
        tableBody.innerHTML += row;
      });

      // Update last updated timestamp
      if (track1Data.last_updated) {
        const lastUpdated = new Date(track1Data.last_updated).toLocaleString();
        document.getElementById('last-updated').textContent = `Last updated: ${lastUpdated}`;
      }
    }

    // Load Track 1 leaderboard data
    console.log("Attempting to load Track 1 leaderboard data...");
    fetch("leaderboard/track1.json")
      .then(res => {
        if (!res.ok) throw new Error("Failed to load Track 1 leaderboard");
        return res.json();
      })
      .then(data => {
        track1Data = data;
        displayTrack1Leaderboards();
      })
      .catch(err => {
        console.error("Error loading Track 1 leaderboard:", err);
        const gen1Table = document.getElementById("gen1ou-leaderboard");
        const gen9Table = document.getElementById("gen9ou-leaderboard");
        const errorRow = `<tr style="border-bottom: 1px solid #e2e8f0;">
          <td style="padding: 10px; color: #718096;">-</td>
          <td style="padding: 10px; color: #718096;">Error loading data</td>
          <td style="padding: 10px; text-align: center; color: #718096;">-</td>
          <td style="padding: 10px; text-align: center; color: #718096;">-</td>
          <td style="padding: 10px; text-align: center; color: #718096;">-</td>
        </tr>`;
        gen1Table.innerHTML = errorRow;
        gen9Table.innerHTML = errorRow;
      });

    // Define milestone order for progression
    const milestoneOrder = [
      'littleroot_town', 'starter_chosen', 'oldale_town', 'route_103', 'received_pokedex',
      'petalburg_city', 'dad_first_meeting', 'petalburg_woods', 'rustboro_city', 
      'rustboro_gym_entered', 'first_gym_complete'
    ];
    
    const milestoneNames = {
      'littleroot_town': 'Littleroot Town',
      'starter_chosen': 'Starter Chosen',
      'oldale_town': 'Oldale Town',
      'route_103': 'Route 103',
      'received_pokedex': 'Received Pokedex',
      'petalburg_city': 'Petalburg City',
      'dad_first_meeting': 'Dad First Meeting',
      'petalburg_woods': 'Petalburg Woods',
      'rustboro_city': 'Rustboro City',
      'rustboro_gym_entered': 'Rustboro Gym Entered',
      'first_gym_complete': 'First Gym Complete'
    };
    
    const phaseNames = {
      'Phase_1_Game_Initialization': 'Milestone 1: Game Start',
      'Phase_2_Tutorial_Starting_Town': 'Milestone 2: Littleroot Town',
      'Phase_3_Professor_Birch_Starter': 'Milestone 3: Starter Pokemon',
      'Phase_4_Rival': 'Milestone 4: Rival Battle',
      'Phase_5_Route_102_Petalburg': 'Milestone 5: Petalburg City',
      'Phase_6_Road_to_Rustboro_City': 'Milestone 6: Route to Rustboro',
      'Phase_7_First_Gym_Challenge': 'Milestone 7: First Gym'
    };
    
    // Detailed milestone definitions from MILESTONES.md
    const phaseMilestones = {
      'Phase_1_Game_Initialization': [
        { key: 'GAME_RUNNING', name: 'Game Running' },
        { key: 'PLAYER_NAME_SET', name: 'Player Name Set' },
        { key: 'INTRO_CUTSCENE_COMPLETE', name: 'Intro Complete' }
      ],
      'Phase_2_Tutorial_Starting_Town': [
        { key: 'LITTLEROOT_TOWN', name: 'Littleroot Town' },
        { key: 'PLAYER_HOUSE_ENTERED', name: 'Player House' },
        { key: 'PLAYER_BEDROOM', name: 'Player Bedroom' },
        { key: 'RIVAL_HOUSE', name: 'Rival House' },
        { key: 'RIVAL_BEDROOM', name: 'Rival Bedroom' }
      ],
      'Phase_3_Professor_Birch_Starter': [
        { key: 'ROUTE_101', name: 'Route 101' },
        { key: 'STARTER_CHOSEN', name: 'Starter Chosen' },
        { key: 'BIRCH_LAB_VISITED', name: 'Birch Lab' }
      ],
      'Phase_4_Rival': [
        { key: 'OLDALE_TOWN', name: 'Oldale Town' },
        { key: 'ROUTE_103', name: 'Route 103' },
        { key: 'RECEIVED_POKEDEX', name: 'Received Pokedex' }
      ],
      'Phase_5_Route_102_Petalburg': [
        { key: 'ROUTE_102', name: 'Route 102' },
        { key: 'PETALBURG_CITY', name: 'Petalburg City' },
        { key: 'DAD_FIRST_MEETING', name: 'Dad First Meeting' },
        { key: 'GYM_EXPLANATION', name: 'Gym Explanation' }
      ],
      'Phase_6_Road_to_Rustboro_City': [
        { key: 'ROUTE_104_SOUTH', name: 'Route 104 South' },
        { key: 'PETALBURG_WOODS', name: 'Petalburg Woods' },
        { key: 'TEAM_AQUA_GRUNT_DEFEATED', name: 'Team Aqua Defeated' },
        { key: 'ROUTE_104_NORTH', name: 'Route 104 North' },
        { key: 'RUSTBORO_CITY', name: 'Rustboro City' }
      ],
      'Phase_7_First_Gym_Challenge': [
        { key: 'RUSTBORO_GYM_ENTERED', name: 'Rustboro Gym' },
        { key: 'ROXANNE_DEFEATED', name: 'Roxanne Defeated' },
        { key: 'FIRST_GYM_COMPLETE', name: 'First Gym Complete' }
      ]
    };
    
    let currentViewMode = 'overall';

    // Function to get furthest milestone for a team
    function getFurthestMilestone(entry) {
      for (let i = milestoneOrder.length - 1; i >= 0; i--) {
        const milestone = milestoneOrder[i];
        const splitField = `split_${milestone}`;
        if (entry[splitField] && entry[splitField] !== '-' && entry[splitField] !== '') {
          return {
            milestone: milestone,
            time: entry[splitField],
            name: milestoneNames[milestone]
          };
        }
      }
      return { milestone: 'none', time: '-', name: 'None' };
    }

    // Function to parse time string to seconds for sorting
    function parseTimeToSeconds(timeStr) {
      if (!timeStr || timeStr === '-') return Infinity;
      
      // Handle formats like "1:23:45", "23:45", or "45"
      const parts = timeStr.split(':').map(p => parseInt(p) || 0);
      if (parts.length === 3) {
        return parts[0] * 3600 + parts[1] * 60 + parts[2]; // hours:minutes:seconds
      } else if (parts.length === 2) {
        return parts[0] * 60 + parts[1]; // minutes:seconds
      } else {
        return parts[0] || 0; // seconds
      }
    }

    // Function to change view mode
    function changeViewMode() {
      const viewMode = document.getElementById('view-mode-select').value;
      currentViewMode = viewMode;
      
      const milestoneSelect = document.getElementById('milestone-select');
      const milestoneLabel = document.getElementById('milestone-filter-label');
      const viewDescription = document.getElementById('view-description');
      
      if (viewMode === 'milestones') {
        milestoneSelect.style.display = 'inline-block';
        milestoneLabel.style.display = 'inline-block';
        viewDescription.innerHTML = '<strong>Milestone Splits View:</strong> Shows detailed progress through each milestone with sub-milestone completion. Teams that reach later milestones rank higher.';
      } else {
        milestoneSelect.style.display = 'none';
        milestoneLabel.style.display = 'none';
        viewDescription.innerHTML = '<strong>Overall Progress View:</strong> Shows completion percentage and total runtime summed across completed milestones. Teams with multiple submissions show their best combined milestone times.';
      }
      
      displaySpeedrunningLeaderboard();
    }
    
    // Function to filter and display speedrunning leaderboard
    function filterByMilestone() {
      const selectedMilestone = document.getElementById('milestone-select').value;
      displaySpeedrunningLeaderboard(selectedMilestone);
    }

    function displaySpeedrunningLeaderboard(filterMilestone = 'all') {
      const tableBody = document.getElementById("speedrunning-leaderboard");
      const tableHeader = document.getElementById("speedrunning-header");
      
      if (!speedrunningData || speedrunningData.length === 0) {
        tableBody.innerHTML = `<tr style="border-bottom: 1px solid #e2e8f0;">
          <td style="padding: 15px; color: #718096;" colspan="5">No leaderboard data available</td>
        </tr>`;
        return;
      }

      // Update table headers based on view mode
      if (currentViewMode === 'overall') {
        tableHeader.innerHTML = `
          <tr>
            <th style="padding: 12px 15px; font-size: 0.9rem; font-weight: 600; color: #4a5568; text-align: left;">Rank</th>
            <th style="padding: 12px 15px; font-size: 0.9rem; font-weight: 600; color: #4a5568; text-align: left;">Team</th>
            <th style="padding: 12px 15px; font-size: 0.9rem; font-weight: 600; color: #4a5568; text-align: center;">Progress</th>
            <th style="padding: 12px 15px; font-size: 0.9rem; font-weight: 600; color: #4a5568; text-align: center;">Total Runtime</th>
            <th style="padding: 12px 15px; font-size: 0.9rem; font-weight: 600; color: #4a5568; text-align: center;">Details</th>
          </tr>`;
      } else {
        // Milestone view - change header based on filter
        const timeColumnHeader = filterMilestone === 'all' ? 'Total Runtime' : 'Split Time';
        tableHeader.innerHTML = `
          <tr>
            <th style="padding: 12px 15px; font-size: 0.9rem; font-weight: 600; color: #4a5568; text-align: left;">Rank</th>
            <th style="padding: 12px 15px; font-size: 0.9rem; font-weight: 600; color: #4a5568; text-align: left;">Team</th>
            <th style="padding: 12px 15px; font-size: 0.9rem; font-weight: 600; color: #4a5568; text-align: center;">Milestone Progress</th>
            <th style="padding: 12px 15px; font-size: 0.9rem; font-weight: 600; color: #4a5568; text-align: center;">${timeColumnHeader}</th>
            <th style="padding: 12px 15px; font-size: 0.9rem; font-weight: 600; color: #4a5568; text-align: center;">Video</th>
          </tr>`;
      }

      let processedData = [];

      if (currentViewMode === 'overall') {
        // Overall progress view - show completion % and sum of phase durations
        processedData = speedrunningData.map(entry => {
          let totalDurationMs = 0;
          let phasesCompleted = 0;
          let totalPhases = 7;
          
          // Calculate sum of phase durations
          if (entry.phase_splits) {
            Object.values(entry.phase_splits).forEach(phase => {
              if (phase.completed > 0 && phase.duration && phase.duration !== '-') {
                const durationMs = parseTimeToSeconds(phase.duration) * 1000;
                if (!isNaN(durationMs) && durationMs > 0) {
                  totalDurationMs += durationMs;
                }
                if (phase.completed === phase.total) {
                  phasesCompleted++;
                }
              }
            });
          }
          
          // Format total duration
          let formattedDuration = '-';
          if (totalDurationMs > 0) {
            const totalSeconds = Math.floor(totalDurationMs / 1000);
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;
            
            if (hours > 0) {
              formattedDuration = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            } else {
              formattedDuration = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
          }
          
          return {
            team: entry.team,
            completionPercent: entry.completion_percent,
            runtime: formattedDuration,
            timeInSeconds: totalDurationMs / 1000,
            video: entry.video,
            submissionCount: entry.submission_count || 1,
            phaseSplits: entry.phase_splits || {},
            phasesCompleted: phasesCompleted,
            totalPhases: totalPhases
          };
        });
        
        // Sort by completion percentage first, then by time
        processedData.sort((a, b) => {
          if (b.completionPercent !== a.completionPercent) {
            return b.completionPercent - a.completionPercent;
          }
          return a.timeInSeconds - b.timeInSeconds;
        });
        
      } else {
        // Milestone splits view - using phases as milestones with sub-milestone details
        const phaseOrder = Object.keys(phaseNames);
        
        speedrunningData.forEach(entry => {
          if (entry.phase_splits && Object.keys(entry.phase_splits).length > 0) {
            if (filterMilestone === 'all') {
              // Show furthest phase reached with sub-milestone details
              let latestPhase = null;
              let latestPhaseIndex = -1;
              let cumulativeDurationMs = 0;
              let submilestoneDetails = {};
              
              // Process all phases to get sub-milestone details
              for (let i = 0; i < phaseOrder.length; i++) {
                const phase = phaseOrder[i];
                const milestones = phaseMilestones[phase];
                submilestoneDetails[phase] = [];
                
                // Check sub-milestones for this phase
                for (const milestone of milestones) {
                  let splitTime = null;
                  
                  // Check milestone_splits first (new format)
                  if (entry.milestone_splits && entry.milestone_splits[milestone.key]) {
                    splitTime = entry.milestone_splits[milestone.key];
                  }
                  
                  submilestoneDetails[phase].push({
                    name: milestone.name,
                    key: milestone.key,
                    time: splitTime,
                    completed: splitTime !== null
                  });
                }
                
                // Update latest phase if this phase has progress
                if (entry.phase_splits[phase] && entry.phase_splits[phase].completed > 0) {
                  latestPhase = phase;
                  latestPhaseIndex = i;
                  
                  // Add this phase's duration to cumulative total
                  const duration = entry.phase_splits[phase].duration;
                  if (duration && duration !== '-') {
                    cumulativeDurationMs += parseTimeToSeconds(duration) * 1000;
                  }
                }
              }
              
              if (latestPhase) {
                const phaseSplit = entry.phase_splits[latestPhase];
                
                // Format cumulative duration
                let formattedCumulativeTime = '-';
                if (cumulativeDurationMs > 0) {
                  const totalSeconds = Math.floor(cumulativeDurationMs / 1000);
                  const hours = Math.floor(totalSeconds / 3600);
                  const minutes = Math.floor((totalSeconds % 3600) / 60);
                  const seconds = totalSeconds % 60;
                  
                  if (hours > 0) {
                    formattedCumulativeTime = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                  } else {
                    formattedCumulativeTime = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                  }
                }
                
                // For "All" view, use cumulative time; for specific phase, use phase duration
                processedData.push({
                  team: entry.team,
                  phase: phaseNames[latestPhase],
                  phaseKey: latestPhase,
                  phaseIndex: latestPhaseIndex,
                  phaseSplits: entry.phase_splits,
                  submilestoneDetails: submilestoneDetails,
                  completed: phaseSplit.completed,
                  total: phaseSplit.total,
                  splitTime: formattedCumulativeTime,  // Total runtime for "All" view
                  timeInSeconds: cumulativeDurationMs / 1000, // For sorting
                  video: entry.video
                });
              }
            } else {
              // Show specific phase with sub-milestone details
              const phaseIndex = phaseOrder.indexOf(filterMilestone);
              const phaseSplit = entry.phase_splits[filterMilestone];
              
              if (phaseSplit && phaseSplit.completed > 0) {
                let cumulativeDurationMs = 0;
                let submilestoneDetails = {};
                
                // Get sub-milestone details for selected phase
                const milestones = phaseMilestones[filterMilestone];
                submilestoneDetails[filterMilestone] = [];
                
                for (const milestone of milestones) {
                  let splitTime = null;
                  
                  // Check milestone_splits first (new format)
                  if (entry.milestone_splits && entry.milestone_splits[milestone.key]) {
                    splitTime = entry.milestone_splits[milestone.key];
                  }
                  
                  submilestoneDetails[filterMilestone].push({
                    name: milestone.name,
                    key: milestone.key,
                    time: splitTime,
                    completed: splitTime !== null
                  });
                }
                
                // Calculate cumulative duration up to and including this phase
                for (let i = 0; i <= phaseIndex; i++) {
                  const phase = phaseOrder[i];
                  if (entry.phase_splits[phase] && entry.phase_splits[phase].completed > 0) {
                    const duration = entry.phase_splits[phase].duration;
                    if (duration && duration !== '-') {
                      cumulativeDurationMs += parseTimeToSeconds(duration) * 1000;
                    }
                  } else {
                    break; // Stop if we hit an incomplete phase before the target
                  }
                }
                
                // Format cumulative duration
                let formattedCumulativeTime = '-';
                if (cumulativeDurationMs > 0) {
                  const totalSeconds = Math.floor(cumulativeDurationMs / 1000);
                  const hours = Math.floor(totalSeconds / 3600);
                  const minutes = Math.floor((totalSeconds % 3600) / 60);
                  const seconds = totalSeconds % 60;
                  
                  if (hours > 0) {
                    formattedCumulativeTime = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                  } else {
                    formattedCumulativeTime = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                  }
                }
                
                // Get the phase duration (not cumulative) for split time
                const phaseDuration = phaseSplit.duration || '-';
                const phaseDurationSeconds = phaseDuration !== '-' ? parseTimeToSeconds(phaseDuration) : 0;
                
                processedData.push({
                  team: entry.team,
                  phase: phaseNames[filterMilestone],
                  phaseKey: filterMilestone,
                  phaseIndex: phaseIndex,
                  phaseSplits: entry.phase_splits,
                  submilestoneDetails: submilestoneDetails,
                  completed: phaseSplit.completed,
                  total: phaseSplit.total,
                  splitTime: phaseDuration,  // Phase duration only
                  timeInSeconds: phaseDurationSeconds, // For sorting
                  video: entry.video
                });
              }
            }
          }
        });
        
        // Sort by phase progression, then sub-milestones completed, then by time
        processedData.sort((a, b) => {
          if (filterMilestone === 'all') {
            // When showing all phases, sort by phase index first (descending)
            if (a.phaseIndex !== b.phaseIndex) {
              return b.phaseIndex - a.phaseIndex; // Later phases first
            }
            // If same phase, sort by number of sub-milestones completed
            if (a.completed !== b.completed) {
              return b.completed - a.completed; // More sub-milestones first
            }
          } else {
            // When filtering specific phase, sort by sub-milestones completed first
            if (a.completed !== b.completed) {
              return b.completed - a.completed; // More sub-milestones first
            }
          }
          // Finally sort by time (ascending - faster is better)
          return a.timeInSeconds - b.timeInSeconds;
        });
      }

      // Render the table rows based on view mode
      tableBody.innerHTML = '';
      
      if (currentViewMode === 'overall') {
        processedData.forEach((entry, index) => {
          const progressBar = `
            <div style="width: 100%; background: #e2e8f0; border-radius: 4px; overflow: hidden; height: 20px;">
              <div style="width: ${entry.completionPercent}%; background: linear-gradient(90deg, #48bb78, #2f855a); height: 100%; display: flex; align-items: center; padding-left: 5px;">
                <span style="color: white; font-size: 0.8rem; font-weight: 600;">${entry.completionPercent.toFixed(1)}%</span>
              </div>
            </div>`;
          
          const detailsCell = entry.video ? 
            `<a href="${entry.video}" target="_blank" style="color: #007bff; text-decoration: none;"><i class="fab fa-youtube"></i> Video</a>` : 
            `<span style="color: #666; font-size: 0.85rem;">${entry.submissionCount} run${entry.submissionCount > 1 ? 's' : ''}</span>`;
          
          const row = `<tr style="border-bottom: 1px solid #e2e8f0;">
            <td style="padding: 15px; font-size: 0.9rem; color: #2d3748; font-weight: 600;">${index + 1}</td>
            <td style="padding: 15px; font-size: 0.9rem; color: #2d3748; font-weight: 500;">${entry.team}</td>
            <td style="padding: 15px;">${progressBar}</td>
            <td style="padding: 15px; font-size: 0.9rem; color: #2d3748; text-align: center; font-weight: 600;">${entry.runtime}</td>
            <td style="padding: 15px; font-size: 0.9rem; text-align: center;">${detailsCell}</td>
          </tr>`;
          tableBody.innerHTML += row;
        });
        
      } else {
        // Milestone view (phases as milestones with sub-milestone details)
        processedData.forEach((entry, index) => {
          // Create phase progress display with sub-milestone indicators
          const phaseOrder = Object.keys(phaseNames);
          let phaseDisplay = '<div style="width: 100%;">';
          
          // Main milestone progress circles
          phaseDisplay += '<div style="display: flex; gap: 4px; justify-content: center; align-items: center; margin-bottom: 8px;">';
          for (const phase of phaseOrder) {
            const phaseSplit = entry.phaseSplits[phase];
            let phaseColor = '#e2e8f0'; // Default gray
            let phaseTitle = phaseNames[phase];
            
            if (phaseSplit && phaseSplit.completed > 0) {
              const completionRatio = phaseSplit.completed / phaseSplit.total;
              if (completionRatio === 1) {
                phaseColor = '#48bb78'; // Green for complete
              } else {
                phaseColor = '#f6ad55'; // Orange for partial
              }
              phaseTitle += ` (${phaseSplit.completed}/${phaseSplit.total})`;
            }
            
            const phaseNum = phaseOrder.indexOf(phase) + 1;
            phaseDisplay += `<div style="width: 30px; height: 30px; background: ${phaseColor}; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 0.8rem;" title="${phaseTitle}">${phaseNum}</div>`;
          }
          phaseDisplay += '</div>';
          
          // Add sub-milestone progress bars if viewing specific milestone or if this is the latest milestone
          if (filterMilestone !== 'all' || entry.phaseIndex >= 0) {
            const targetPhase = filterMilestone !== 'all' ? filterMilestone : entry.phaseKey;
            const submilestones = entry.submilestoneDetails[targetPhase];
            
            if (submilestones && submilestones.length > 0) {
              const completedCount = submilestones.filter(s => s.completed).length;
              phaseDisplay += '<div style="font-size: 0.75rem; color: #666; text-align: center;">';
              phaseDisplay += `<div style="display: flex; gap: 2px; justify-content: center; margin-top: 4px;">`;
              
              // Show mini progress indicators for each sub-milestone
              for (const submilestone of submilestones) {
                const bgColor = submilestone.completed ? '#48bb78' : '#e2e8f0';
                const tooltip = `${submilestone.name}: ${submilestone.time || 'not reached'}`;
                phaseDisplay += `<div style="width: 8px; height: 8px; background: ${bgColor}; border-radius: 2px;" title="${tooltip}"></div>`;
              }
              
              phaseDisplay += '</div>';
              phaseDisplay += `<span style="margin-top: 2px; display: block;">${phaseNames[targetPhase]} Progress: ${completedCount}/${submilestones.length}</span>`;
              phaseDisplay += '</div>';
            }
          }
          
          phaseDisplay += '</div>';
          
          const videoCell = entry.video ? 
            `<a href="${entry.video}" target="_blank" style="color: #007bff; text-decoration: none;">Watch</a>` : 
            '-';
          
          const row = `<tr style="border-bottom: 1px solid #e2e8f0;">
            <td style="padding: 15px; font-size: 0.9rem; color: #2d3748; font-weight: 600;">${index + 1}</td>
            <td style="padding: 15px; font-size: 0.9rem; color: #2d3748; font-weight: 500;">${entry.team}</td>
            <td style="padding: 15px;">${phaseDisplay}</td>
            <td style="padding: 15px; font-size: 0.9rem; color: #2d3748; text-align: center; font-weight: 600;">${entry.splitTime || '-'}</td>
            <td style="padding: 15px; font-size: 0.9rem; color: #2d3748; text-align: center;">${videoCell}</td>
          </tr>`;
          tableBody.innerHTML += row;
        });
      }

      if (processedData.length === 0) {
        const message = currentViewMode === 'milestones' && filterMilestone !== 'all' ? 
                       'No entries found for selected phase' :
                       'No entries found';
        tableBody.innerHTML = `<tr style="border-bottom: 1px solid #e2e8f0;">
          <td style="padding: 15px; color: #718096;" colspan="5">${message}</td>
        </tr>`;
      }
    }

    // Load speedrunning leaderboard data
    fetch("leaderboard/speedrunning.json")
      .then(res => {
        if (!res.ok) throw new Error("Failed to load speedrunning leaderboard");
        return res.json();
      })
      .then(data => {
        speedrunningData = data;
        displaySpeedrunningLeaderboard(); // Show overall progress by default
      })
      .catch(err => {
        console.error("Error loading speedrunning leaderboard:", err);
        const tableBody = document.getElementById("speedrunning-leaderboard");
        tableBody.innerHTML = `<tr style="border-bottom: 1px solid #e2e8f0;">
          <td style="padding: 15px; color: #718096;" colspan="5">Error loading speedrunning leaderboard data</td>
        </tr>`;
      });

    // Initialize page state
    function initializePage() {
      const llmCheckbox = document.getElementById('show-llm-only');
      const baselineCheckbox = document.getElementById('hide-baselines');
      
      console.log('Initializing page: hideBaselines =', hideBaselines, ', baselineCheckbox.checked =', baselineCheckbox.checked);
      
      // Ensure proper initial state: baselines hidden by default, LLM filter disabled
      llmCheckbox.disabled = baselineCheckbox.checked;
      
      console.log('LLM checkbox disabled:', llmCheckbox.disabled);
    }
    
    // Function to toggle phase details in detailed view
    function togglePhaseDetails(phaseId) {
      const phaseDiv = document.getElementById(phaseId);
      const arrowSpan = document.getElementById(phaseId + '_arrow');
      
      if (phaseDiv.style.display === 'none') {
        phaseDiv.style.display = 'block';
        arrowSpan.innerHTML = '▼';
      } else {
        phaseDiv.style.display = 'none';
        arrowSpan.innerHTML = '▶';
      }
    }
    
    // Make togglePhaseDetails available globally
    window.togglePhaseDetails = togglePhaseDetails;
    
    // Initialize when DOM is ready
    document.addEventListener('DOMContentLoaded', initializePage);

    // Removed Track 1 data loading; external ladder provides live leaderboard
  </script>
</body>
</html>
